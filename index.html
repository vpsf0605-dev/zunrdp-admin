<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZUNRDP | QU·∫¢N TR·ªä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020408; color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 0%, #1e293b 0%, #020408 100%); z-index: -1; }
        .zun-logo { font-weight: 800; font-size: 24px; letter-spacing: -1px; background: linear-gradient(to right, #ffffff, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .rdp-card { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 32px; padding: 24px; margin-bottom: 20px; }
        .btn-action { height: 50px; border-radius: 16px; font-weight: 700; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; width: 100%; }
        .btn-action:active { transform: scale(0.96); opacity: 0.8; }
        .btn-primary { background: #fff; color: #000; }
        .btn-danger { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); }
        .copy-btn { font-size: 10px; background: rgba(59, 130, 246, 0.1); color: #60a5fa; padding: 4px 10px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2); cursor: pointer; font-weight: 700; text-transform: uppercase; }
        .copy-btn:active { background: #3b82f6; color: #fff; transform: scale(0.9); }
        .status-online { width: 8px; height: 8px; background: #10b981; border-radius: 50%; box-shadow: 0 0 10px #10b981; }
        #search-box { transition: all 0.3s ease; width: 0; opacity: 0; overflow: hidden; }
        #search-box.active { width: 140px; opacity: 1; margin-right: 8px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 100; display: none; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body class="p-5 pb-10">
    <div class="bg-overlay"></div>
    <div class="max-w-md mx-auto">
        <header class="flex justify-between items-start mt-4 mb-8">
            <div>
                <div class="zun-logo">ZUN<span>RDP</span></div>
                <p class="text-[9px] font-bold text-slate-500 uppercase tracking-[2px] mt-1">H·ªá Th·ªëng Cloud Vi·ªát Nam</p>
            </div>
            <div class="flex items-center gap-2">
                <div id="search-box">
                    <input type="text" id="search-input" placeholder="T√¨m ID..." class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-xs outline-none w-full">
                </div>
                <button onclick="document.getElementById('search-box').classList.toggle('active')" class="text-slate-400 p-2"><i class="fas fa-search text-lg"></i></button>
                <button onclick="document.getElementById('create-modal').style.display='flex'" class="bg-blue-600 w-10 h-10 rounded-xl flex items-center justify-center shadow-lg shadow-blue-600/20"><i class="fas fa-plus text-white"></i></button>
                <div class="bg-white/5 px-4 py-2 rounded-2xl border border-white/5 text-center min-w-[60px]">
                    <span id="node-count" class="text-xl font-bold text-blue-400">0</span>
                </div>
            </div>
        </header>

        <div id="vm-list" class="space-y-4"></div>
    </div>

    <div id="create-modal" class="modal">
        <div class="bg-[#0f172a] w-full max-w-sm rounded-3xl p-6 border border-white/10">
            <h3 class="text-xl font-extrabold mb-5 flex items-center gap-2">üöÄ T·∫°o M√°y M·ªõi</h3>
            <div class="space-y-4">
                <input type="password" id="gh-token" placeholder="GitHub Token..." class="w-full bg-black/40 border border-white/10 rounded-2xl px-4 py-3 text-sm text-white outline-none">
                <select id="os-choice" class="w-full bg-black/40 border border-white/10 rounded-2xl px-4 py-3 text-sm text-white outline-none">
                    <option value="Windows">Windows Server 2025</option>
                    <option value="Ubuntu">Ubuntu 22.04</option>
                </select>
                <div class="flex gap-3 pt-2">
                    <button onclick="document.getElementById('create-modal').style.display='none'" class="flex-1 bg-white/5 py-4 rounded-2xl font-bold text-xs uppercase text-slate-400">H·ªßy</button>
                    <button onclick="triggerCreate()" class="flex-1 bg-blue-600 py-4 rounded-2xl font-bold text-xs uppercase text-white shadow-lg shadow-blue-600/20">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 z-50 opacity-0 transition-all duration-300 pointer-events-none">
        <div class="bg-blue-600 text-white px-6 py-3 rounded-full font-bold text-xs shadow-2xl"></div>
    </div>

    <script>
        const API_URL = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";
        const REPO = "vpsf0605-dev/zunrdp-Cloud";

        if(localStorage.getItem('gh_token')) document.getElementById('gh-token').value = localStorage.getItem('gh_token');

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.firstElementChild.innerText = msg;
            t.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => t.classList.replace('opacity-100', 'opacity-0'), 2000);
        }

        async function triggerCreate() {
            const token = document.getElementById('gh-token').value.trim();
            const os = document.getElementById('os-choice').value;
            if(!token) return alert("Vui l√≤ng nh·∫≠p Token!");
            localStorage.setItem('gh_token', token);
            showToast("üöÄ ƒêang g·ª≠i y√™u c·∫ßu...");
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/vm.yml/dispatches`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}`, 'Accept': 'application/vnd.github.v3+json' },
                    body: JSON.stringify({ ref: 'main', inputs: { machine_name: os } })
                });
                if(res.status === 204) { showToast("‚úÖ Th√†nh c√¥ng!"); document.getElementById('create-modal').style.display='none'; }
                else alert("L·ªói Token ho·∫∑c quy·ªÅn!");
            } catch (e) { alert("L·ªói k·∫øt n·ªëi GitHub!"); }
        }

        async function refresh() {
            try {
                const res = await fetch(`${API_URL}/vms.json`);
                const data = await res.json();
                const container = document.getElementById('vm-list');
                const query = document.getElementById('search-input').value.toLowerCase();
                let count = 0, html = '';

                for (let id in data) {
                    const vm = data[id];
                    if (Math.floor((Date.now() - vm.lastSeen) / 1000) > 60) continue;
                    if (query && !vm.id.toLowerCase().includes(query)) continue;
                    count++;
                    html += `
                    <div class="rdp-card">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center gap-3"><div class="status-online"></div><h3 class="font-bold text-lg">${vm.id}</h3></div>
                            <span class="text-[9px] font-black text-slate-500 uppercase">${vm.os}</span>
                        </div>
                        <div class="bg-black/40 rounded-2xl p-4 mb-6 border border-white/5 space-y-3">
                            <div class="flex justify-between items-center text-[11px]"><span>IP: <b class="text-blue-400 ml-1">${vm.ip}</b></span><div class="copy-btn" onclick="navigator.clipboard.writeText('${vm.ip}');showToast('ƒê√£ ch√©p IP')">Copy</div></div>
                            <div class="flex justify-between items-center text-[11px] pt-3 border-t border-white/5"><span>User: <b class="text-white ml-1">ADMINZUN</b></span><div class="copy-btn" onclick="navigator.clipboard.writeText('ADMINZUN');showToast('ƒê√£ ch√©p User')">Copy</div></div>
                            <div class="flex justify-between items-center text-[11px] pt-3 border-t border-white/5"><span>Pass: <b class="text-blue-400 ml-1">ZunRDP@123456</b></span><div class="copy-btn" onclick="navigator.clipboard.writeText('ZunRDP@123456');showToast('ƒê√£ ch√©p Pass')">Copy</div></div>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="cmd('${id}', 'restart')" class="btn-action btn-primary"><i class="fas fa-rotate"></i> Restart</button>
                            <button onclick="cmd('${id}', 'kill')" class="btn-action btn-danger"><i class="fas fa-power-off"></i> Kill VM</button>
                        </div>
                    </div>`;
                }
                container.innerHTML = html || '<p class="text-center opacity-20 py-10">Tr·ªëng</p>';
                document.getElementById('node-count').innerText = count;
            } catch (e) {}
        }

        async function cmd(id, type) {
            if(!confirm(`X√°c nh·∫≠n ${type.toUpperCase()} m√°y ${id}?`)) return;
            await fetch(`${API_URL}/commands/${id}.json`, { method: 'PUT', body: JSON.stringify(type) });
            showToast("üöÄ ƒê√£ g·ª≠i l·ªánh!");
        }

        document.getElementById('search-input').addEventListener('input', refresh);
        setInterval(refresh, 5000); refresh();
    </script>
</body>
</html>

