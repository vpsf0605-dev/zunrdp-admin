<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZUNRDP | PREMIUM ADMIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #020617; 
            color: #f8fafc;
            min-height: 100vh;
            background-image: 
                radial-gradient(at 0% 0%, rgba(30, 64, 175, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(59, 130, 246, 0.1) 0px, transparent 50%);
        }

        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .status-pulse {
            width: 10px; height: 10px;
            background: #10b981;
            border-radius: 50%;
            box-shadow: 0 0 15px #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .uptime-badge {
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Monaco', monospace;
            color: #60a5fa;
        }
    </style>
</head>
<body class="p-6">

    <div class="max-w-2xl mx-auto">
        <header class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-3xl font-black tracking-tighter italic text-white">ZUNRDP <span class="text-blue-500">CLOUD</span></h1>
                <p class="text-[10px] uppercase tracking-[0.3em] font-bold opacity-40">H·ªá th·ªëng qu·∫£n tr·ªã t·ªëi cao</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="glass-card px-4 py-2 flex flex-col items-center min-w-[80px]">
                    <span id="total-vms" class="text-xl font-black text-blue-500">0</span>
                    <span class="text-[8px] font-bold opacity-50 uppercase">Online</span>
                </div>
                <button onclick="document.getElementById('add-modal').style.display='flex'" class="w-12 h-12 glass-card flex items-center justify-center text-blue-400">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </header>

        <div id="vm-list" class="space-y-6"></div>
    </div>

    <div id="add-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-6">
        <div class="glass-card w-full max-w-sm p-8">
            <h2 class="text-xl font-bold mb-6 italic">DEPLOY NEW MACHINE</h2>
            <div class="space-y-4">
                <input type="password" id="gh-token" placeholder="GitHub Token" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-white">
                <input type="text" id="owner-name" placeholder="T√™n ng∆∞·ªùi t·∫°o" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-white">
                
                <select id="os-choice" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-white text-sm">
                    <option value="Windows">Windows Server</option>
                    <option value="Ubuntu">Ubuntu Linux</option>
                </select>

                <button id="btn-deploy" onclick="deployVM()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black text-xs uppercase tracking-widest mt-4 transition-all">
                    Kh·ªüi Ch·∫°y
                </button>
                <button onclick="document.getElementById('add-modal').style.display='none'" class="w-full text-xs font-bold opacity-30 uppercase tracking-widest">H·ª¶Y B·ªé</button>
            </div>
        </div>
    </div>

    <script>
        const API = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";
        const REPO = "vpsf0605-dev/zunrdp-Cloud";

        // H√†m t√≠nh th·ªùi gian ch·∫°y
        function getUptime(start) {
            if (!start) return "00h 00m 00s";
            let diff = Math.floor((Date.now() - start) / 1000);
            if (diff < 0) diff = 0;
            let h = Math.floor(diff / 3600).toString().padStart(2, '0');
            let m = Math.floor((diff % 3600) / 60).toString().padStart(2, '0');
            let s = (diff % 60).toString().padStart(2, '0');
            return `${h}h ${m}m ${s}s`;
        }

        // --- T√çNH NƒÇNG T·∫†O VM ƒê√É ƒê∆Ø·ª¢C S·ª¨A L·ªñI ---
        async function deployVM() {
            const token = document.getElementById('gh-token').value;
            const owner = document.getElementById('owner-name').value;
            const os = document.getElementById('os-choice').value;
            const btn = document.getElementById('btn-deploy');

            if (!token || !owner) {
                alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Token v√† T√™n ng∆∞·ªùi t·∫°o!");
                return;
            }

            btn.disabled = true;
            btn.innerText = "ƒêANG G·ª¨I L·ªÜNH...";

            try {
                // G·ª≠i request ƒë·∫øn GitHub API
                const response = await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/vm.yml/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ref: 'main',
                        inputs: {
                            machine_name: os,
                            owner_name: owner
                        }
                    })
                });

                if (response.status === 204) {
                    alert("üöÄ Th√†nh c√¥ng! M√°y ·∫£o ƒëang ƒë∆∞·ª£c kh·ªüi t·∫°o tr√™n GitHub.");
                    document.getElementById('add-modal').style.display = 'none';
                } else {
                    const errorData = await response.json();
                    alert("‚ùå L·ªói: " + (errorData.message || "Ki·ªÉm tra l·∫°i Token ho·∫∑c t√™n Repo"));
                }
            } catch (err) {
                alert("‚ùå L·ªói k·∫øt n·ªëi: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "KH·ªûI CH·∫†Y";
            }
        }

        async function refresh() {
            try {
                const res = await fetch(`${API}/vms.json`);
                const data = await res.json() || {};
                let html = '', count = 0;

                for (let id in data) {
                    const vm = data[id];
                    if (Date.now() - vm.lastSeen > 60000) continue;
                    count++;

                    html += `
                    <div class="glass-card p-6 border-l-4 border-l-blue-500">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center gap-4">
                                <div class="status-pulse"></div>
                                <div>
                                    <h3 class="text-xl font-extrabold text-white tracking-tight">${vm.id}</h3>
                                    <div class="flex items-center gap-2 mt-1">
                                        <i class="fas fa-user-circle text-[10px] opacity-40"></i>
                                        <span class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">${vm.owner || 'UNKNOWN'}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-[8px] font-bold opacity-30 uppercase mb-1">Th·ªùi gian ch·∫°y</p>
                                <div class="uptime-badge text-xs font-bold">${getUptime(vm.startTime)}</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-6 bg-white/5 p-4 rounded-2xl border border-white/5">
                            <div>
                                <p class="text-[8px] opacity-30 font-bold uppercase mb-1">ƒê·ªãa ch·ªâ IP</p>
                                <p class="text-xs font-bold text-white">${vm.ip}</p>
                            </div>
                            <div>
                                <p class="text-[8px] opacity-30 font-bold uppercase mb-1">M·∫≠t kh·∫©u</p>
                                <p class="text-xs font-bold text-white">ZunRDP@123456</p>
                            </div>
                        </div>

                        <div class="flex gap-2">
                            <button onclick="navigator.clipboard.writeText('${vm.ip}'); alert('ƒê√£ copy IP!')" class="flex-1 h-12 glass-card hover:bg-white/5 text-[10px] font-bold uppercase tracking-widest transition-all">Copy IP</button>
                            <button onclick="killVM('${id}')" class="w-12 h-12 bg-red-500/10 text-red-500 rounded-xl border border-red-500/20 hover:bg-red-500 hover:text-white transition-all flex items-center justify-center">
                                <i class="fas fa-power-off"></i>
                            </button>
                        </div>
                    </div>`;
                }
                document.getElementById('vm-list').innerHTML = html || '<p class="text-center py-20 opacity-20 italic font-bold uppercase tracking-widest text-xs">Ch∆∞a c√≥ m√°y n√†o online</p>';
                document.getElementById('total-vms').innerText = count;
            } catch (e) {}
        }

        async function killVM(id) {
            if(confirm("T·∫Øt m√°y ngay l·∫≠p t·ª©c?")) {
                await fetch(`${API}/commands/${id}.json`, { method: 'PUT', body: JSON.stringify('kill') });
                alert("ƒê√£ g·ª≠i l·ªánh t·∫Øt m√°y!");
            }
        }

        setInterval(refresh, 1000); 
        refresh();
    </script>
</body>
</html>

