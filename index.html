<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZUNRDP | ADMIN CLOUD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: #f8fafc; min-height: 100vh;
            background-image: radial-gradient(at 0% 0%, rgba(30, 64, 175, 0.1) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(59, 130, 246, 0.1) 0px, transparent 50%);
        }
        .glass-card { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px; }
        .status-pulse { width: 10px; height: 10px; background: #10b981; border-radius: 50%; box-shadow: 0 0 15px #10b981; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.4); opacity: 0.5; } }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-2xl mx-auto">
        <header class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-3xl font-black italic">ZUNRDP <span class="text-blue-500">CLOUD</span></h1>
                <p class="text-[9px] uppercase tracking-[0.3em] font-bold opacity-40">Admin Dashboard v2.0</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="glass-card px-5 py-2 flex flex-col items-center">
                    <span id="total-vms" class="text-xl font-black text-blue-500">0</span>
                    <span class="text-[8px] font-bold opacity-50 uppercase">Online</span>
                </div>
                <button onclick="document.getElementById('add-modal').style.display='flex'" class="w-12 h-12 glass-card flex items-center justify-center text-blue-400 hover:scale-110 transition-all">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </header>

        <div id="vm-list" class="space-y-6"></div>
    </div>

    <div id="add-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-6">
        <div class="glass-card w-full max-w-sm p-8">
            <h2 class="text-xl font-bold mb-6 italic text-white text-center">DEPLOY NEW VM</h2>
            <div class="space-y-4 text-sm">
                <input type="password" id="gh-token" placeholder="GitHub Token" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-white">
                <input type="text" id="owner-name" placeholder="T√™n ng∆∞·ªùi t·∫°o" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-white">
                <select id="os-choice" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 outline-none text-white">
                    <option value="Windows">Windows Server</option>
                    <option value="Ubuntu">Ubuntu Linux</option>
                </select>
                <button id="btn-deploy" onclick="deployVM()" class="w-full bg-blue-600 py-4 rounded-xl font-black text-xs uppercase tracking-widest mt-4">KH·ªûI CH·∫†Y</button>
                <button onclick="document.getElementById('add-modal').style.display='none'" class="w-full text-[10px] font-bold opacity-30 uppercase tracking-[0.2em]">H·ª¶Y B·ªé</button>
            </div>
        </div>
    </div>

    <script>
        const API = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";
        const REPO = "vpsf0605-dev/zunrdp-Cloud";

        function getUptime(start) {
            if (!start) return "00h 00m 00s";
            let diff = Math.floor((Date.now() - start) / 1000);
            if (diff < 0) diff = 0;
            let h = Math.floor(diff / 3600).toString().padStart(2, '0');
            let m = Math.floor((diff % 3600) / 60).toString().padStart(2, '0');
            let s = (diff % 60).toString().padStart(2, '0');
            return `${h}h ${m}m ${s}s`;
        }

        async function deployVM() {
            const token = document.getElementById('gh-token').value;
            const owner = document.getElementById('owner-name').value;
            const os = document.getElementById('os-choice').value;
            const btn = document.getElementById('btn-deploy');
            if(!token || !owner) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·ªß!");
            
            btn.disabled = true; btn.innerText = "SENDING...";
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/vm.yml/dispatches`, {
                    method: 'POST', headers: { 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ ref: 'main', inputs: { machine_name: os, owner_name: owner } })
                });
                if(res.ok) { alert("üöÄ ƒê√£ g·ª≠i l·ªánh kh·ªüi t·∫°o!"); document.getElementById('add-modal').style.display='none'; }
                else alert("‚ùå Token ho·∫∑c Repo sai!");
            } catch(e) { alert("L·ªói!"); } finally { btn.disabled = false; btn.innerText = "KH·ªûI CH·∫†Y"; }
        }

        async function killVM(id) {
            if(confirm(`X√°c nh·∫≠n T·∫ÆT NGAY m√°y: ${id}?`)) {
                await fetch(`${API}/vms/${id}.json`, { 
                    method: 'PATCH', 
                    body: JSON.stringify({ command: 'kill' }) 
                });
                alert("L·ªánh t·ª≠ h√¨nh ƒë√£ g·ª≠i!");
            }
        }

        async function refresh() {
            try {
                const res = await fetch(`${API}/vms.json`);
                const data = await res.json() || {};
                let html = '', count = 0;
                for (let id in data) {
                    const vm = data[id];
                    if (Date.now() - vm.lastSeen > 60000) continue;
                    count++;
                    html += `
                    <div class="glass-card p-6 border-l-4 border-l-blue-500">
                        <div class="flex justify-between items-start mb-5">
                            <div class="flex items-center gap-4">
                                <div class="status-pulse"></div>
                                <div>
                                    <h3 class="text-lg font-black text-white tracking-tight">${vm.id}</h3>
                                    <span class="text-[10px] font-bold text-blue-400 uppercase">By: ${vm.owner}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-[8px] font-bold opacity-30 uppercase block mb-1">Th·ªùi gian ch·∫°y</span>
                                <span class="text-white font-mono font-bold text-xs bg-white/5 px-2 py-1 rounded-lg">${getUptime(vm.startTime)}</span>
                            </div>
                        </div>
                        <div class="bg-black/30 rounded-2xl p-4 mb-5 border border-white/5 flex flex-col gap-2">
                            <div class="flex justify-between text-[11px]"><span class="opacity-40">IP ADDRESS:</span> <span class="text-blue-400 font-bold">${vm.ip}</span></div>
                            <div class="flex justify-between text-[11px] border-t border-white/5 pt-2"><span class="opacity-40">USER/PASS:</span> <span class="text-white">ADMINZUN / ZunRDP@123456</span></div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="navigator.clipboard.writeText('${vm.ip}'); alert('Copied IP!')" class="flex-1 h-12 glass-card hover:bg-white/5 text-[10px] font-bold uppercase tracking-widest">Copy IP</button>
                            <button onclick="killVM('${id}')" class="w-12 h-12 bg-red-500/10 text-red-500 rounded-xl border border-red-500/20 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all"><i class="fas fa-power-off"></i></button>
                        </div>
                    </div>`;
                }
                document.getElementById('vm-list').innerHTML = html || '<p class="text-center py-20 opacity-20 italic">No VM Online</p>';
                document.getElementById('total-vms').innerText = count;
            } catch (e) {}
        }
        setInterval(refresh, 1000); refresh();
    </script>
</body>
</html>

