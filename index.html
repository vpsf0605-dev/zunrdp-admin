<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZUNRDP | QU·∫¢N TR·ªä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020408; color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 0%, #1e293b 0%, #020408 100%); z-index: -1; }
        .zun-logo { font-weight: 800; font-size: 24px; background: linear-gradient(to right, #ffffff, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .rdp-card { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 32px; padding: 24px; margin-bottom: 20px; }
        .btn-action { height: 48px; border-radius: 16px; font-weight: 700; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 6px; transition: 0.2s; width: 100%; }
        .btn-user { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.2); }
        .btn-kill { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); }
        .time-select { background: #000; color: #fff; border: none; font-size: 10px; outline: none; cursor: pointer; font-weight: 800; }
        .copy-btn { font-size: 10px; background: rgba(255,255,255,0.05); color: #94a3b8; padding: 4px 8px; border-radius: 8px; cursor: pointer; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 100; display: none; align-items: center; justify-content: center; padding: 20px; }
        input, select { background: rgba(0,0,0,0.4) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; outline: none; }
    </style>
</head>
<body class="p-5 pb-10">
    <div class="bg-overlay"></div>
    <div class="max-w-md mx-auto">
        <header class="flex justify-between items-center mb-8 mt-4">
            <div class="zun-logo">ZUN<span>RDP</span></div>
            <div class="flex items-center gap-2">
                <button onclick="document.getElementById('create-modal').style.display='flex'" class="bg-blue-600 w-10 h-10 rounded-xl flex items-center justify-center"><i class="fas fa-plus text-white"></i></button>
                <div class="bg-white/5 px-4 py-2 rounded-2xl border border-white/5"><span id="node-count" class="text-xl font-bold text-blue-400">0</span></div>
            </div>
        </header>

        <div id="vm-list" class="space-y-4"></div>
    </div>

    <div id="create-modal" class="modal">
        <div class="bg-[#0f172a] w-full max-w-sm rounded-3xl p-6 border border-white/10">
            <h3 class="text-xl font-bold mb-5 italic">üöÄ T·∫°o M√°y M·ªõi</h3>
            <div class="space-y-4">
                <input type="password" id="gh-token" placeholder="GitHub Token..." class="w-full rounded-2xl px-4 py-3 text-sm">
                <input type="text" id="owner-name" placeholder="T√™n Admin..." class="w-full rounded-2xl px-4 py-3 text-sm">
                <select id="os-choice" class="w-full rounded-2xl px-4 py-3 text-sm">
                    <option value="Windows">Windows Server 2025</option>
                    <option value="Ubuntu">Ubuntu 22.04</option>
                </select>
                <div class="flex gap-3 pt-2">
                    <button onclick="document.getElementById('create-modal').style.display='none'" class="flex-1 bg-white/5 py-4 rounded-2xl font-bold text-xs uppercase text-slate-400">H·ªßy</button>
                    <button onclick="triggerCreate()" class="flex-1 bg-blue-600 py-4 rounded-2xl font-bold text-xs uppercase text-white shadow-lg shadow-blue-600/20">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 z-50 opacity-0 transition-all duration-300 pointer-events-none">
        <div class="bg-blue-600 text-white px-6 py-3 rounded-full font-bold text-xs shadow-2xl" id="toast-msg"></div>
    </div>

    <script>
        const API_URL = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";
        const REPO = "vpsf0605-dev/zunrdp-Cloud";

        if(localStorage.getItem('gh_token')) document.getElementById('gh-token').value = localStorage.getItem('gh_token');
        if(localStorage.getItem('zun_owner')) document.getElementById('owner-name').value = localStorage.getItem('zun_owner');

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => t.classList.replace('opacity-100', 'opacity-0'), 2000);
        }

        async function triggerCreate() {
            const token = document.getElementById('gh-token').value.trim();
            const owner = document.getElementById('owner-name').value.trim();
            const os = document.getElementById('os-choice').value;
            if(!token || !owner) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");
            localStorage.setItem('gh_token', token);
            localStorage.setItem('zun_owner', owner);
            showToast("üöÄ ƒêang g·ª≠i l·ªánh t·∫°o...");
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/vm.yml/dispatches`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}`, 'Accept': 'application/vnd.github.v3+json' },
                    body: JSON.stringify({ ref: 'main', inputs: { machine_name: os, owner_name: owner } })
                });
                if(res.status === 204) { showToast("‚úÖ ƒê√£ g·ª≠i l·ªánh!"); document.getElementById('create-modal').style.display='none'; }
                else alert("L·ªói GitHub!");
            } catch (e) { alert("L·ªói k·∫øt n·ªëi!"); }
        }

        async function refresh() {
            try {
                const res = await fetch(`${API_URL}/vms.json`);
                const data = await res.json() || {};
                const container = document.getElementById('vm-list');
                let count = 0, html = '';
                for (let id in data) {
                    const vm = data[id];
                    if (Math.floor((Date.now() - vm.lastSeen) / 1000) > 60) continue;
                    count++;
                    html += `
                    <div class="rdp-card">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center gap-3"><div class="w-2 h-2 bg-emerald-500 rounded-full shadow-[0_0_8px_#10b981]"></div><h3 class="font-bold text-lg">${vm.id}</h3></div>
                            <span class="text-[9px] font-black text-slate-500 uppercase">${vm.os}</span>
                        </div>
                        <div class="bg-black/40 rounded-2xl p-4 mb-6 border border-white/5 space-y-3 font-mono text-[11px]">
                            <div class="flex justify-between"><span>IP: <b class="text-blue-400">${vm.ip}</b></span><div class="copy-btn" onclick="navigator.clipboard.writeText('${vm.ip}');showToast('ƒê√£ ch√©p IP')">Copy</div></div>
                            <div class="flex justify-between pt-3 border-t border-white/5"><span>User: <b>ADMINZUN</b></span><div class="copy-btn" onclick="navigator.clipboard.writeText('ADMINZUN');showToast('ƒê√£ ch√©p User')">Copy</div></div>
                            <div class="flex justify-between pt-3 border-t border-white/5"><span>Pass: <b class="text-blue-400">ZunRDP@123456</b></span><div class="copy-btn" onclick="navigator.clipboard.writeText('ZunRDP@123456');showToast('ƒê√£ ch√©p Pass')">Copy</div></div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="btn-action btn-user">
                                <i class="fas fa-user-shield"></i>
                                <span class="truncate max-w-[60px]">${vm.owner || 'Admin'}</span>
                                <select class="time-select ml-1" onchange="scheduleKill('${id}', this.value)">
                                    <option value="">üïí T·∫ÆT</option>
                                    <option value="30">30P</option>
                                    <option value="60">1H</option>
                                    <option value="120">2H</option>
                                    <option value="360">6H</option>
                                </select>
                            </div>
                            <button onclick="sendCmd('${id}', 'kill')" class="btn-action btn-kill"><i class="fas fa-power-off"></i> KILL VM</button>
                        </div>
                    </div>`;
                }
                container.innerHTML = html || '<p class="text-center opacity-20 py-10">TR·ªêNG</p>';
                document.getElementById('node-count').innerText = count;
            } catch (e) {}
        }

        async function sendCmd(id, type) {
            if(!confirm(`X√°c nh·∫≠n th·ª±c hi·ªán l·ªánh tr√™n ${id}?`)) return;
            await fetch(`${API_URL}/commands/${id}.json`, { method: 'PUT', body: JSON.stringify(type) });
            showToast("üöÄ ƒê√£ g·ª≠i l·ªánh!");
        }

        async function scheduleKill(id, mins) {
            if(!mins) return;
            if(!confirm(`H·∫πn gi·ªù t·∫Øt m√°y ${id} sau ${mins} ph√∫t?`)) return;
            // G·ª≠i l·ªánh d·∫°ng 'kill_in_30' ƒë·ªÉ script tr√™n m√°y ·∫£o x·ª≠ l√Ω
            await fetch(`${API_URL}/commands/${id}.json`, { method: 'PUT', body: JSON.stringify(`kill_in_${mins}`) });
            showToast(`‚è∞ ƒê√£ ƒë·∫∑t l·ªãch t·∫Øt sau ${mins}p!`);
        }

        setInterval(refresh, 5000); refresh();
    </script>
</body>
</html>

