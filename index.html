<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZUNRDP | CLOUD MONITOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background: #020617; color: #f8fafc; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 28px; }
        .status-pulse { width: 10px; height: 10px; background: #22c55e; border-radius: 50%; box-shadow: 0 0 15px #22c55e; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        .info-row { display: flex; justify-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .uptime-tag { background: rgba(59, 130, 246, 0.1); color: #60a5fa; padding: 4px 12px; border-radius: 99px; font-size: 11px; font-weight: 700; border: 1px solid rgba(59, 130, 246, 0.2); }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-xl mx-auto">
        <header class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-3xl font-black tracking-tighter bg-gradient-to-r from-white to-blue-500 bg-clip-text text-transparent italic">ZUNRDP CLOUD</h1>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]">H·ªá th·ªëng gi√°m s√°t th·ªùi gian th·ª±c</p>
            </div>
            <button onclick="document.getElementById('deploy-modal').style.display='flex'" class="w-12 h-12 glass flex items-center justify-center text-blue-400 hover:scale-110 transition-all">
                <i class="fas fa-plus"></i>
            </button>
        </header>

        <div id="vm-list" class="space-y-6"></div>
    </div>

    <div id="deploy-modal" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center p-6">
        <div class="glass w-full max-w-sm p-8">
            <h2 class="text-2xl font-black mb-6 flex items-center gap-3"><i class="fas fa-rocket text-blue-500"></i> T·∫°o m√°y ·∫£o</h2>
            <div class="space-y-4">
                <input type="password" id="gh-token" placeholder="GitHub Token" class="w-full bg-slate-900 border border-slate-800 rounded-2xl px-5 py-4 text-sm outline-none focus:border-blue-500/50 transition-all">
                <input type="text" id="owner-name" placeholder="T√™n ng∆∞·ªùi t·∫°o (VD: Admin Zun)" class="w-full bg-slate-900 border border-slate-800 rounded-2xl px-5 py-4 text-sm outline-none focus:border-blue-500/50 transition-all">
                <div class="flex gap-4 pt-4">
                    <button onclick="document.getElementById('deploy-modal').style.display='none'" class="flex-1 font-bold opacity-40 text-xs uppercase tracking-widest">ƒê√≥ng</button>
                    <button onclick="startDeploy()" class="flex-1 bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black text-xs uppercase tracking-widest shadow-lg shadow-blue-500/20">Kh·ªüi ch·∫°y</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";
        const REPO = "vpsf0605-dev/zunrdp-Cloud";

        function calcUptime(startTime) {
            if(!startTime) return "ƒêang t√≠nh...";
            const diff = Math.floor((Date.now() - startTime) / 1000);
            const h = Math.floor(diff / 3600);
            const m = Math.floor((diff % 3600) / 60);
            return h > 0 ? `${h} gi·ªù ${m} ph√∫t` : `${m} ph√∫t`;
        }

        async function refresh() {
            try {
                const res = await fetch(`${API}/vms.json`);
                const data = await res.json() || {};
                let html = '';
                
                for (let id in data) {
                    const vm = data[id];
                    if (Date.now() - vm.lastSeen > 65000) continue; // ·∫®n m√°y offline qu√° 1 ph√∫t

                    // Gi·∫£ s·ª≠ vm.startTime ƒë∆∞·ª£c l∆∞u khi m√°y ·∫£o b·∫Øt ƒë·∫ßu ch·∫°y
                    const uptime = calcUptime(vm.startTime || (Date.now() - 300000)); // Demo: m·∫∑c ƒë·ªãnh hi·ªán 5p n√™√∫ thi·∫øu d·ªØ li·ªáu

                    html += `
                    <div class="glass p-6 relative overflow-hidden group hover:border-blue-500/30 transition-all">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center gap-4">
                                <div class="status-pulse"></div>
                                <div>
                                    <h3 class="text-xl font-black tracking-tight text-white">${vm.id}</h3>
                                    <span class="uptime-tag mt-2 inline-block"><i class="fas fa-hourglass-start mr-2"></i>ƒê√£ ch·∫°y: ${uptime}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest block mb-1">H·ªá ƒëi·ªÅu h√†nh</span>
                                <span class="bg-white/5 px-3 py-1 rounded-lg text-[10px] font-bold border border-white/5">${vm.os}</span>
                            </div>
                        </div>

                        <div class="bg-slate-950/50 rounded-3xl p-5 mb-6 space-y-1 border border-white/5 font-mono text-[11px]">
                            <div class="info-row"><span class="opacity-40 uppercase">Ng∆∞·ªùi t·∫°o:</span> <span class="text-blue-400 font-bold">${vm.owner || 'N/A'}</span></div>
                            <div class="info-row"><span class="opacity-40 uppercase">ƒê·ªãa ch·ªâ IP:</span> <span class="text-white">${vm.ip}</span></div>
                            <div class="info-row"><span class="opacity-40 uppercase">T√†i kho·∫£n:</span> <span class="text-white">ADMINZUN</span></div>
                            <div class="info-row border-none"><span class="opacity-40 uppercase">M·∫≠t kh·∫©u:</span> <span class="text-white">ZunRDP@123456</span></div>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="copyInfo('${vm.ip}')" class="flex-1 bg-white/5 hover:bg-white/10 h-14 rounded-2xl font-bold text-[11px] uppercase tracking-widest transition-all">Copy IP</button>
                            <button onclick="killMachine('${id}')" class="w-14 h-14 bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white rounded-2xl border border-red-500/20 transition-all flex items-center justify-center">
                                <i class="fas fa-power-off text-lg"></i>
                            </button>
                        </div>
                    </div>`;
                }
                document.getElementById('vm-list').innerHTML = html || '<div class="py-20 text-center opacity-20 font-black uppercase tracking-[0.3em] text-xs">Kh√¥ng c√≥ m√°y online</div>';
            } catch (e) {}
        }

        function copyInfo(ip) {
            navigator.clipboard.writeText(ip);
            alert("ƒê√£ copy IP: " + ip);
        }

        async function killMachine(id) {
            if(confirm("X√°c nh·∫≠n ng·∫Øt k·∫øt n·ªëi m√°y ·∫£o n√†y?")) {
                await fetch(`${API}/commands/${id}.json`, { method: 'PUT', body: JSON.stringify('kill') });
            }
        }

        async function startDeploy() {
            const t = document.getElementById('gh-token').value;
            const o = document.getElementById('owner-name').value;
            if(!t || !o) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·ªß th√¥ng tin!");
            
            const res = await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/vm.yml/dispatches`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${t}`, 'Accept': 'application/vnd.github.v3+json' },
                body: JSON.stringify({ ref: 'main', inputs: { machine_name: 'Windows', owner_name: o } })
            });
            if(res.status === 204) {
                alert("üöÄ L·ªánh kh·ªüi t·∫°o m√°y ·∫£o ƒë√£ ƒë∆∞·ª£c g·ª≠i!");
                document.getElementById('deploy-modal').style.display = 'none';
            }
        }

        setInterval(refresh, 5000);
        refresh();
    </script>
</body>
</html>

