<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZUNRDP | PREMIUM ADMIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020408; color: #f8fafc; }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 0%, #1e293b 0%, #020408 100%); z-index: -1; }
        .zun-logo { font-weight: 800; font-size: 24px; background: linear-gradient(to right, #ffffff, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 28px; padding: 20px; margin-bottom: 16px; }
        .btn-plus { width: 42px; height: 42px; background: #3b82f6; border-radius: 14px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; shadow: 0 4px 15px rgba(59, 130, 246, 0.4); }
        #search-container { display: flex; align-items: center; background: rgba(255,255,255,0.05); border-radius: 14px; padding: 0 12px; border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s; width: 42px; overflow: hidden; }
        #search-container.active { width: 150px; background: rgba(255,255,255,0.1); border-color: rgba(59, 130, 246, 0.4); }
        #search-input { background: transparent; border: none; color: white; outline: none; font-size: 12px; width: 100%; margin-left: 8px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 100; display: none; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body class="p-5">
    <div class="bg-overlay"></div>
    <div class="max-w-md mx-auto">
        <header class="flex justify-between items-center mb-8 mt-2">
            <div>
                <div class="zun-logo">ZUN<span>RDP</span></div>
                <p class="text-[8px] font-bold text-slate-500 uppercase tracking-[2px]">Cloud Management</p>
            </div>
            <div class="flex items-center gap-2">
                <div id="search-container">
                    <i class="fas fa-search text-slate-400" onclick="document.getElementById('search-container').classList.toggle('active'); document.getElementById('search-input').focus();"></i>
                    <input type="text" id="search-input" placeholder="T√¨m ID...">
                </div>
                <div class="btn-plus" onclick="document.getElementById('create-modal').style.display='flex'"><i class="fas fa-plus text-white"></i></div>
                <div class="bg-white/5 px-3 py-1.5 rounded-xl border border-white/5 text-center">
                    <span id="node-count" class="text-lg font-bold text-blue-400">0</span>
                </div>
            </div>
        </header>

        <div id="vm-list" class="space-y-4"></div>
    </div>

    <div id="create-modal" class="modal">
        <div class="bg-[#0f172a] w-full max-w-sm rounded-3xl p-6 border border-white/10 shadow-2xl">
            <h3 class="text-xl font-extrabold mb-5 flex items-center gap-2"><i class="fas fa-server text-blue-500"></i> T·∫°o M√°y M·ªõi</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] text-slate-400 font-bold uppercase ml-1">GitHub Token</label>
                    <input type="password" id="gh-token" placeholder="D√°n Token v√†o ƒë√¢y..." class="w-full bg-black/40 border border-white/10 rounded-2xl px-4 py-3 outline-none mt-1 text-sm focus:border-blue-500 transition-all">
                </div>
                <div>
                    <label class="text-[10px] text-slate-400 font-bold uppercase ml-1">H·ªá ƒëi·ªÅu h√†nh</label>
                    <select id="os-choice" class="w-full bg-black/40 border border-white/10 rounded-2xl px-4 py-3 outline-none mt-1 text-sm appearance-none">
                        <option value="Windows">Windows Server 2025</option>
                        <option value="Ubuntu">Ubuntu 22.04</option>
                    </select>
                </div>
                <div class="flex gap-3 pt-4">
                    <button onclick="document.getElementById('create-modal').style.display='none'" class="flex-1 bg-white/5 py-4 rounded-2xl font-bold text-xs uppercase">H·ªßy</button>
                    <button onclick="triggerCreate()" class="flex-1 bg-blue-600 py-4 rounded-2xl font-bold text-xs uppercase shadow-lg shadow-blue-600/20">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] opacity-0 transition-all duration-300 pointer-events-none">
        <div class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold text-xs shadow-2xl" id="toast-msg"></div>
    </div>

    <script>
        const API = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";
        const REPO = "vpsf0605-dev/zunrdp-Cloud";
        const WORKFLOW = "blank.yml"; // ƒê√£ ƒë·ªïi theo y√™u c·∫ßu c·ªßa b·∫°n

        // Load token c≈© n·∫øu c√≥
        if(localStorage.getItem('gh_token')) document.getElementById('gh-token').value = localStorage.getItem('gh_token');

        function showToast(m) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = m;
            t.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => t.classList.replace('opacity-100', 'opacity-0'), 2500);
        }

        async function triggerCreate() {
            const token = document.getElementById('gh-token').value.trim();
            const os = document.getElementById('os-choice').value;
            if(!token) return alert("Vui l√≤ng nh·∫≠p Token!");
            
            localStorage.setItem('gh_token', token);
            showToast("üöÄ ƒêang g·ª≠i l·ªánh t·ªõi GitHub...");

            try {
                const res = await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/${WORKFLOW}/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ ref: 'main', inputs: { machine_name: os } })
                });

                if(res.status === 204) {
                    showToast("‚úÖ Th√†nh c√¥ng! ƒêang kh·ªüi t·∫°o m√°y...");
                    setTimeout(() => document.getElementById('create-modal').style.display='none', 1500);
                } else {
                    const err = await res.json();
                    alert("L·ªói: " + (err.message || "Ki·ªÉm tra l·∫°i Token ho·∫∑c file blank.yml"));
                }
            } catch (e) { alert("Kh√¥ng th·ªÉ k·∫øt n·ªëi GitHub!"); }
        }

        async function refresh() {
            try {
                const res = await fetch(`${API}/vms.json`);
                const data = await res.json() || {};
                let h = ''; let c = 0;
                for(let id in data) {
                    const vm = data[id];
                    if(Math.floor((Date.now() - vm.lastSeen)/1000) > 60) continue;
                    c++;
                    h += `<div class="card"><div class="flex justify-between items-center mb-4"><div><h3 class="font-bold text-lg">${vm.id}</h3><span class="text-[10px] text-blue-400 font-bold uppercase">${vm.os} ONLINE</span></div><i class="fas fa-circle text-emerald-500 text-[10px] shadow-[0_0_8px_#10b981]"></i></div><div class="bg-black/30 p-4 rounded-2xl text-[11px] space-y-2 font-mono"><div class="flex justify-between"><span>IP:</span><b class="text-blue-400">${vm.ip}</b></div><div class="flex justify-between"><span>USER:</span><b>ADMINZUN</b></div><div class="flex justify-between"><span>PASS:</span><b class="text-blue-400">ZunRDP@123456</b></div></div></div>`;
                }
                document.getElementById('vm-list').innerHTML = h || '<p class="text-center opacity-20 py-10 text-xs">KH√îNG C√ì M√ÅY HO·∫†T ƒê·ªòNG</p>';
                document.getElementById('node-count').innerText = c;
            } catch(e){}
        }
        setInterval(refresh, 5000); refresh();
    </script>
</body>
</html>
