<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZUNRDP | ADMIN DASHBOARD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #010409; color: #c9d1d9; }
        .glass-panel { background: rgba(22, 27, 34, 0.8); backdrop-filter: blur(15px); border: 1px solid rgba(48, 54, 61, 0.8); border-radius: 20px; }
        .vm-card { background: linear-gradient(145deg, #161b22, #0d1117); border: 1px solid #30363d; transition: all 0.3s ease; }
        .vm-card:hover { border-color: #58a6ff; transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .status-online { width: 12px; height: 12px; background: #238636; border-radius: 50%; box-shadow: 0 0 10px #238636; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .badge-owner { background: rgba(56, 139, 253, 0.15); color: #58a6ff; padding: 2px 10px; border-radius: 6px; font-size: 11px; border: 1px solid rgba(56, 139, 253, 0.3); }
        .uptime-text { color: #7d8590; font-size: 12px; font-family: monospace; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-10">
    <div class="max-w-4xl mx-auto">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-black text-white flex items-center gap-3">
                    <i class="fas fa-shield-alt text-blue-500"></i> ZUNRDP ADMIN
                </h1>
                <p class="text-sm text-slate-500 mt-1">B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n l√Ω m√°y ·∫£o to√†n c·∫ßu</p>
            </div>
            <div class="flex gap-4 items-center">
                <div class="glass-panel px-6 py-3 text-center">
                    <span class="text-[10px] block opacity-50 font-bold uppercase tracking-widest text-blue-400">ƒêang ch·∫°y</span>
                    <span id="total-vms" class="text-2xl font-black text-white">0</span>
                </div>
                <button onclick="document.getElementById('modal').style.display='flex'" class="bg-blue-600 hover:bg-blue-500 w-12 h-12 rounded-xl flex items-center justify-center transition-all shadow-lg shadow-blue-900/20">
                    <i class="fas fa-plus text-white"></i>
                </button>
            </div>
        </div>

        <div id="vm-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center p-4">
        <div class="glass-panel w-full max-w-md p-8 border-slate-700">
            <h2 class="text-xl font-bold mb-6 text-white"><i class="fas fa-plus-circle mr-2"></i> Deploy M√°y ·∫¢o M·ªõi</h2>
            <div class="space-y-4">
                <input type="password" id="gh-token" placeholder="Nh·∫≠p GitHub Token" class="w-full bg-[#0d1117] border border-[#30363d] rounded-xl px-4 py-3 outline-none focus:border-blue-500">
                <input type="text" id="owner-name" placeholder="T√™n ng∆∞·ªùi t·∫°o" class="w-full bg-[#0d1117] border border-[#30363d] rounded-xl px-4 py-3 outline-none focus:border-blue-500">
                <div class="flex gap-4 pt-2">
                    <button onclick="document.getElementById('modal').style.display='none'" class="flex-1 py-3 font-bold opacity-50">H·ªßy</button>
                    <button onclick="deploy()" class="flex-1 bg-blue-600 py-3 rounded-xl font-bold shadow-lg shadow-blue-900/30">Kh·ªüi Ch·∫°y</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";
        const REPO = "vpsf0605-dev/zunrdp-Cloud";
        let timers = {};

        function formatUptime(start) {
            if (!start) return "00:00:00";
            let diff = Math.floor((Date.now() - start) / 1000);
            let h = Math.floor(diff / 3600);
            let m = Math.floor((diff % 3600) / 60);
            let s = diff % 60;
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }

        async function refresh() {
            try {
                const res = await fetch(`${API}/vms.json`);
                const data = await res.json() || {};
                const container = document.getElementById('vm-container');
                let html = '', count = 0;

                for (let id in data) {
                    const vm = data[id];
                    if (Date.now() - vm.lastSeen > 60000) continue;
                    count++;

                    html += `
                    <div class="vm-card p-6 rounded-[24px]">
                        <div class="flex justify-between items-start mb-5">
                            <div class="flex items-center gap-3">
                                <div class="status-online"></div>
                                <div>
                                    <h3 class="text-lg font-bold text-white tracking-tight">${vm.id}</h3>
                                    <span class="badge-owner">By: ${vm.owner || 'Admin'}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="uptime-text block mb-1">UPTIME</span>
                                <span class="text-white font-mono font-bold">${formatUptime(vm.startTime)}</span>
                            </div>
                        </div>

                        <div class="space-y-2 mb-6 bg-black/20 p-4 rounded-xl border border-white/5">
                            <div class="flex justify-between text-xs"><span class="opacity-40">IP ADDRESS:</span> <span class="text-blue-400 font-bold">${vm.ip}</span></div>
                            <div class="flex justify-between text-xs"><span class="opacity-40">USER:</span> <span class="text-white">ADMINZUN</span></div>
                            <div class="flex justify-between text-xs"><span class="opacity-40">PASS:</span> <span class="text-white">ZunRDP@123456</span></div>
                        </div>

                        <div class="flex gap-2">
                            <div class="flex-1 flex bg-black/40 rounded-xl px-3 items-center border border-white/10 h-12">
                                <input type="number" id="v-${id}" placeholder="H·∫πn gi·ªù" class="bg-transparent w-full text-center outline-none text-sm font-bold">
                                <select id="u-${id}" class="bg-transparent text-[10px] font-black uppercase text-blue-500 outline-none">
                                    <option value="60">M</option>
                                    <option value="1">S</option>
                                    <option value="3600">H</option>
                                </select>
                            </div>
                            <button onclick="kill('${id}')" class="w-12 h-12 bg-red-500/10 text-red-500 rounded-xl border border-red-500/20 hover:bg-red-500 hover:text-white transition-all">
                                <i class="fas fa-power-off"></i>
                            </button>
                        </div>
                    </div>`;
                }
                container.innerHTML = html || '<div class="col-span-full py-20 text-center opacity-20 font-bold">KH√îNG C√ì M√ÅY ONLINE</div>';
                document.getElementById('total-vms').innerText = count;
            } catch (e) {}
        }

        async function deploy() {
            const t = document.getElementById('gh-token').value;
            const o = document.getElementById('owner-name').value;
            if(!t || !o) return alert("Thi·∫øu th√¥ng tin!");
            const res = await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/vm.yml/dispatches`, {
                method: 'POST', headers: { 'Authorization': `Bearer ${t}` },
                body: JSON.stringify({ ref: 'main', inputs: { machine_name: 'Windows', owner_name: o } })
            });
            if(res.ok) { alert("üöÄ ƒê√£ Deploy!"); document.getElementById('modal').style.display='none'; }
        }

        async function kill(id) {
            const v = document.getElementById(`v-${id}`).value;
            const u = document.getElementById(`u-${id}`).value;
            let cmd = 'kill';
            if(v > 0) cmd = `kill_in_${v * u}`;
            
            await fetch(`${API}/commands/${id}.json`, { method: 'PUT', body: JSON.stringify(cmd) });
            alert(v > 0 ? "‚è∞ ƒê√£ ƒë·∫∑t h·∫πn gi·ªù t·∫Øt!" : "üöÄ ƒê√£ g·ª≠i l·ªánh t·∫Øt ngay!");
        }

        setInterval(refresh, 5000); refresh();
        setInterval(() => refresh(), 1000); // C·∫≠p nh·∫≠t uptime m·ªói gi√¢y
    </script>
</body>
</html>

