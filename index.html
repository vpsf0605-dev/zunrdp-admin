<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZUNRDP | ADMIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #020408; color: #fff; font-family: sans-serif; }
        .zun-logo { font-weight: 800; font-size: 24px; background: linear-gradient(to right, #fff, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; margin-bottom: 15px; }
        .owner-tag { background: #3b82f6; color: #fff; padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; }
        .copy-btn { font-size: 10px; color: #60a5fa; cursor: pointer; font-weight: bold; text-transform: uppercase; border: 1px solid rgba(96, 165, 250, 0.3); padding: 2px 6px; border-radius: 4px; }
        .copy-btn:active { background: #3b82f6; color: #fff; }
    </style>
</head>
<body class="p-4">
    <div class="max-w-md mx-auto">
        <header class="flex justify-between items-center mb-8">
            <div>
                <div class="zun-logo">ZUN<span>RDP</span></div>
                <div class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">Hệ Thống Cloud</div>
            </div>
            <div class="text-right">
                <span id="node-count" class="text-xl font-bold text-blue-400">0</span>
                <p class="text-[8px] text-gray-500 font-bold uppercase">Online</p>
            </div>
        </header>

        <div id="list" class="space-y-4">
            <p class="text-center opacity-20 py-20"><i class="fas fa-circle-notch fa-spin text-2xl"></i></p>
        </div>
    </div>

    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 z-50 hidden">
        <div class="bg-blue-600 text-white px-6 py-2 rounded-full font-bold text-xs shadow-lg"></div>
    </div>

    <script>
        const API_URL = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.firstElementChild.innerText = msg;
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 2000);
        }

        function copy(text, label) {
            navigator.clipboard.writeText(text);
            showToast(`Đã chép ${label}`);
        }

        async function refresh() {
            try {
                const res = await fetch(`${API_URL}/vms.json`);
                const data = await res.json();
                let html = '';
                let count = 0;
                
                for(let id in data) {
                    const vm = data[id];
                    const diff = Math.floor((Date.now() - vm.lastSeen) / 1000);
                    if(diff > 60) continue; // Ẩn máy nếu offline quá 60s
                    count++;

                    html += `<div class="card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg text-blue-400 font-mono">${vm.id}</h3>
                                <span class="owner-tag"><i class="fas fa-user mr-1"></i> ${vm.owner || 'Chưa rõ'}</span>
                            </div>
                            <div class="text-right">
                                <span class="text-[9px] bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded font-bold uppercase">${vm.os}</span>
                                <p class="text-[8px] text-gray-500 mt-1 italic">${diff}s trước</p>
                            </div>
                        </div>

                        <div class="bg-black/30 p-4 rounded-xl text-xs space-y-3 border border-white/5">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">IP Address:</span>
                                <div class="flex items-center gap-2">
                                    <b class="text-white font-mono">${vm.ip}</b>
                                    <span class="copy-btn" onclick="copy('${vm.ip}', 'IP')">Copy</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center border-t border-white/5 pt-2">
                                <span class="text-gray-400">User:</span>
                                <div class="flex items-center gap-2">
                                    <b class="text-white font-mono">ADMINZUN</b>
                                    <span class="copy-btn" onclick="copy('ADMINZUN', 'User')">Copy</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center border-t border-white/5 pt-2">
                                <span class="text-gray-400">Password:</span>
                                <div class="flex items-center gap-2">
                                    <b class="text-blue-400 font-mono">ZunRDP@123456</b>
                                    <span class="copy-btn" onclick="copy('ZunRDP@123456', 'Pass')">Copy</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-2 mt-5">
                            <button onclick="sendCmd('${id}','restart')" class="w-1/2 bg-white text-black py-2.5 rounded-lg font-bold text-[11px] active:scale-95 transition-transform">RESTART</button>
                            <button onclick="sendCmd('${id}','kill')" class="w-1/2 bg-red-500/10 text-red-500 border border-red-500/20 py-2.5 rounded-lg font-bold text-[11px] active:scale-95 transition-transform">STOP VM</button>
                        </div>
                    </div>`;
                }
                document.getElementById('list').innerHTML = html || '<p class="text-center opacity-30 py-20">Hiện không có máy online</p>';
                document.getElementById('node-count').innerText = count;
            } catch(e){}
        }

        async function sendCmd(id, t) {
            if(confirm(`Xác nhận thực hiện lệnh trên máy ${id}?`)) {
                await fetch(`${API_URL}/commands/${id}.json`, {method:'PUT', body:JSON.stringify(t)});
                showToast("Đã gửi lệnh!");
            }
        }

        refresh();
        setInterval(refresh, 5000);
    </script>
</body>
</html>

