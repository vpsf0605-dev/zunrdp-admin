<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZUNRDP | MONITOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020408; color: #fff; font-family: sans-serif; }
        .zun-logo { font-weight: 800; font-size: 24px; background: linear-gradient(to right, #fff, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; margin-bottom: 15px; }
        .owner-tag { background: #3b82f6; color: #fff; padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body class="p-4">
    <div class="max-w-md mx-auto">
        <header class="flex justify-between items-center mb-8">
            <div class="zun-logo">ZUN<span>RDP</span></div>
            <div class="text-[10px] text-gray-500 font-bold uppercase">Hệ Thống Cloud</div>
        </header>

        <div id="list" class="space-y-4">
            <p class="text-center opacity-20">Đang tải dữ liệu...</p>
        </div>
    </div>

    <script>
        const API = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";

        async function refresh() {
            try {
                const res = await fetch(`${API}/vms.json`);
                const data = await res.json();
                let html = '';
                
                for(let id in data) {
                    const vm = data[id];
                    const diff = Math.floor((Date.now() - vm.lastSeen) / 1000);
                    if(diff > 60) continue; // Chỉ hiện máy online trong vòng 60s

                    html += `<div class="card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg">${vm.id}</h3>
                                <span class="owner-tag">Chủ sở hữu: ${vm.owner}</span>
                            </div>
                            <span class="text-[9px] text-emerald-400 font-bold uppercase tracking-widest">${vm.os} ONLINE</span>
                        </div>
                        <div class="bg-black/30 p-4 rounded-xl text-xs space-y-3">
                            <div class="flex justify-between"><span>IP Address:</span><b class="text-blue-400 font-mono">${vm.ip}</b></div>
                            <div class="flex justify-between border-t border-white/5 pt-2"><span>User:</span><b>${vm.user}</b></div>
                            <div class="flex justify-between border-t border-white/5 pt-2"><span>Password:</span><b class="text-blue-400">${vm.pass}</b></div>
                        </div>
                        <div class="flex gap-2 mt-5">
                            <button onclick="cmd('${id}','restart')" class="w-full bg-white text-black py-2.5 rounded-lg font-bold text-[11px]">KHỞI ĐỘNG LẠI</button>
                            <button onclick="cmd('${id}','kill')" class="w-full bg-red-500/10 text-red-500 py-2.5 rounded-lg font-bold text-[11px]">NGẮT MÁY</button>
                        </div>
                    </div>`;
                }
                document.getElementById('list').innerHTML = html || '<p class="text-center opacity-30 py-20">Hiện không có máy ảo nào trực tuyến</p>';
            } catch(e){}
        }

        async function cmd(id, t) {
            if(confirm("Xác nhận thực hiện lệnh?")) {
                await fetch(`${API}/commands/${id}.json`, {method:'PUT', body:JSON.stringify(t)});
                alert("Đã gửi yêu cầu!");
            }
        }

        refresh();
        setInterval(refresh, 5000);
    </script>
</body>
</html>
