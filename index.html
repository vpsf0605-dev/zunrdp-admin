<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZUNRDP | ADMIN CLOUD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #030712; color: #f8fafc; overflow-x: hidden; }
        
        /* Hi·ªáu ·ª©ng k√≠nh v√† vi·ªÅn s√°ng */
        .glass-card { 
            background: rgba(17, 24, 39, 0.7); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            border-radius: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .glass-card:hover { border-color: rgba(59, 130, 246, 0.5); transform: translateY(-5px); }
        
        /* Ch·∫•m Online nh·∫•p nh√°y */
        .online-indicator {
            width: 12px; height: 12px;
            background: #10b981;
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 15px #10b981;
        }
        .online-indicator::after {
            content: ''; position: absolute; inset: -4px;
            border-radius: 50%; border: 2px solid #10b981;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(2.5); opacity: 0; } }

        /* N√∫t copy & kill */
        .btn-action { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; transition: all 0.2s; }
        .btn-action:hover { background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; }
        .btn-kill { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .btn-kill:hover { background: #ef4444; color: white; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
            <div class="text-center md:text-left">
                <h1 class="text-4xl font-extrabold tracking-tighter italic text-white italic">
                    ZUNRDP <span class="text-blue-500 not-italic uppercase text-2xl ml-2">Cloud</span>
                </h1>
                <p class="text-slate-500 text-sm font-semibold mt-2 uppercase tracking-widest">H·ªá th·ªëng gi√°m s√°t m√°y ·∫£o to√†n c·∫ßu</p>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="glass-card px-8 py-3 flex flex-col items-center">
                    <span id="vm-count" class="text-3xl font-black text-blue-500">0</span>
                    <span class="text-[10px] font-bold opacity-40 uppercase tracking-tighter">M√°y Online</span>
                </div>
                <button onclick="document.getElementById('deploy-modal').style.display='flex'" class="w-16 h-16 glass-card flex items-center justify-center text-blue-400 text-xl shadow-lg shadow-blue-500/10">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>

        <div id="vm-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            </div>
    </div>

    <div id="deploy-modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-50 hidden items-center justify-center p-6">
        <div class="glass-card w-full max-w-sm p-8 border-white/10 shadow-2xl">
            <div class="flex items-center gap-4 mb-8">
                <div class="w-12 h-12 bg-blue-500/20 rounded-2xl flex items-center justify-center text-blue-500 text-xl">
                    <i class="fas fa-rocket"></i>
                </div>
                <h2 class="text-2xl font-black italic">T·∫†O M√ÅY M·ªöI</h2>
            </div>
            <div class="space-y-4">
                <input type="password" id="gh-token" placeholder="GitHub Token" class="w-full bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-sm outline-none focus:border-blue-500/50">
                <input type="text" id="owner-name" placeholder="T√™n c·ªßa b·∫°n (VD: Admin Zun)" class="w-full bg-black/40 border border-white/5 rounded-2xl px-5 py-4 text-sm outline-none focus:border-blue-500/50">
                <div class="flex gap-4 pt-6">
                    <button onclick="document.getElementById('deploy-modal').style.display='none'" class="flex-1 font-bold opacity-30 text-sm">H·ª¶Y</button>
                    <button onclick="startDeploy()" class="flex-1 bg-blue-600 py-4 rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl shadow-blue-500/20">KH·ªûI CH·∫†Y</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://zunrdp-default-rtdb.asia-southeast1.firebasedatabase.app";
        const GH_REPO = "vpsf0605-dev/zunrdp-Cloud";

        function formatUptime(startTime) {
            if (!startTime) return "00h 00m";
            let diff = Math.floor((Date.now() - startTime) / 1000);
            let h = Math.floor(diff / 3600);
            let m = Math.floor((diff % 3600) / 60);
            let s = diff % 60;
            return `${h > 0 ? h + 'h ' : ''}${m}m ${s}s`;
        }

        async function refresh() {
            try {
                const res = await fetch(`${API_URL}/vms.json`);
                const data = await res.json() || {};
                const grid = document.getElementById('vm-grid');
                let html = '', count = 0;

                for (let id in data) {
                    const vm = data[id];
                    if (Date.now() - vm.lastSeen > 65000) continue; // Check m√°y online trong 1 ph√∫t
                    count++;

                    html += `
                    <div class="glass-card p-6 relative overflow-hidden">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center gap-4">
                                <div class="online-indicator"></div>
                                <div>
                                    <h3 class="text-xl font-black text-white tracking-tight">${vm.id}</h3>
                                    <p class="text-[10px] text-blue-400 font-bold uppercase tracking-widest mt-1">
                                        <i class="fas fa-user-circle mr-1"></i> ${vm.owner || 'Admin'}
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-[9px] font-black opacity-30 uppercase block">Th·ªùi gian ch·∫°y</span>
                                <span class="text-white font-mono font-bold text-sm">${formatUptime(vm.startTime)}</span>
                            </div>
                        </div>

                        <div class="bg-black/40 rounded-2xl p-4 mb-6 space-y-3 border border-white/5">
                            <div class="flex justify-between items-center">
                                <span class="text-[10px] opacity-40 font-bold">IP ADDRESS</span>
                                <div class="flex items-center gap-3">
                                    <span class="text-sm font-mono font-bold">${vm.ip}</span>
                                    <button onclick="copy('${vm.ip}')" class="text-blue-500 text-xs"><i class="fas fa-copy"></i></button>
                                </div>
                            </div>
                            <div class="flex justify-between items-center border-t border-white/5 pt-3 text-[10px]">
                                <span class="opacity-40 font-bold uppercase">User/Pass</span>
                                <span class="font-bold text-white">ADMINZUN / ZunRDP@123456</span>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="copy('ADMINZUN | ZunRDP@123456')" class="flex-1 h-12 btn-action font-black text-[10px] uppercase tracking-widest">Copy TK/MK</button>
                            <button onclick="killMachine('${id}')" class="w-12 h-12 btn-action btn-kill flex items-center justify-center transition-all">
                                <i class="fas fa-power-off"></i>
                            </button>
                        </div>
                    </div>`;
                }
                grid.innerHTML = html || '<div class="col-span-full py-20 text-center opacity-20 font-black italic">Kh√¥ng c√≥ m√°y n√†o ƒëang ch·∫°y...</div>';
                document.getElementById('vm-count').innerText = count;
            } catch (e) {}
        }

        function copy(t) { navigator.clipboard.writeText(t); alert("ƒê√£ copy: " + t); }

        async function killMachine(id) {
            if (confirm("D·ª´ng m√°y n√†y ngay l·∫≠p t·ª©c?")) {
                await fetch(`${API_URL}/commands/${id}.json`, { method: 'PUT', body: JSON.stringify('kill') });
            }
        }

        async function startDeploy() {
            const token = document.getElementById('gh-token').value;
            const owner = document.getElementById('owner-name').value;
            const res = await fetch(`https://api.github.com/repos/${GH_REPO}/actions/workflows/vm.yml/dispatches`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` },
                body: JSON.stringify({ ref: 'main', inputs: { machine_name: 'Windows', owner_name: owner } })
            });
            if (res.ok) {
                alert("üöÄ L·ªánh kh·ªüi ch·∫°y ƒë√£ ƒë∆∞·ª£c g·ª≠i!");
                document.getElementById('deploy-modal').style.display = 'none';
            }
        }

        setInterval(refresh, 5000); refresh();
        setInterval(() => refresh(), 1000); // Update uptime li√™n t·ª•c
    </script>
</body>
</html>

